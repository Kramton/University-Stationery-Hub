-- 
-- Run this command first in phpMyAdmin: 
-- 
CREATE DATABASE IF NOT EXISTS php_project;


USE php_project;


CREATE TABLE IF NOT EXISTS `products` (
  `product_id` int(11) NOT NULL AUTO_INCREMENT,
  `product_name` varchar(100) NOT NULL,
  `product_category` varchar(100) NOT NULL,
  `product_description` varchar(255) NOT NULL,
  `product_image` varchar(255) NOT NULL,
  `product_image2` varchar(255) NOT NULL,
  `product_image3` varchar(255) NOT NULL,
  `product_image4` varchar(255) NOT NULL,
  `product_price` decimal(6,2) NOT NULL,
  `product_special_offer` integer(2) NOT NULL,
  `product_color` varchar(100) NOT NULL,
  PRIMARY KEY (`product_id`)
) ENGINE=InnoDB DEFAULT CHARSET=latin1;



CREATE TABLE IF NOT EXISTS `orders` (
  `order_id` int(11) NOT NULL AUTO_INCREMENT,
  `order_cost` decimal(6,2) NOT NULL,
  `order_status` varchar(20) NOT NULL DEFAULT 'on_hold',
  `user_id` int(11) NOT NULL,
  `user_phone` varchar(255) NOT NULL,
  `user_city` varchar(255) NOT NULL,
  `user_address` varchar(255) NOT NULL,
  `order_date` DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP,
  PRIMARY KEY (`order_id`)
) ENGINE=InnoDB DEFAULT CHARSET=latin1;



CREATE TABLE IF NOT EXISTS `order_items` (
  `item_id` int(11) NOT NULL AUTO_INCREMENT,
  `order_id` int(11) NOT NULL,
  `product_id` int(11) NOT NULL,
  `product_name` varchar(255) NOT NULL,
  `product_image` varchar(255) NOT NULL,
  `product_price` decimal(6,2) NOT NULL,
  `product_quantity` int NOT NULL,
  `user_id` int(11) NOT NULL,
  `order_date` DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP,
  PRIMARY KEY (`item_id`)
) ENGINE=InnoDB DEFAULT CHARSET=latin1;



CREATE TABLE IF NOT EXISTS `users` (
  `user_id` int(11) NOT NULL AUTO_INCREMENT,
  `user_name` varchar(100) NOT NULL,
  `user_email` varchar(100) NOT NULL,
  `user_password` varchar(100) NOT NULL,
  PRIMARY KEY (`user_id`),
  UNIQUE KEY `UK_constraint` (`user_email`)
) ENGINE=InnoDB DEFAULT CHARSET=latin1;


CREATE TABLE IF NOT EXISTS `payments` (
    `payment_id` int(11) NOT NULL AUTO_INCREMENT,
    `order_id` int(11) NOT NULL,
    `user_id` int(11) NOT NULL,
    `transaction_id` varchar(250) NOT NULL,
    `payment_date` DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP,
    PRIMARY KEY (`payment_id`)
) ENGINE=InnoDB DEFAULT CHARSET=latin1;

CREATE TABLE `php_project`.`admins` (`admin_id` INT NOT NULL 
AUTO_INCREMENT , `admin_name` VARCHAR(250) NOT NULL , 
`admin_email` TEXT NOT NULL , `admin_password` TEXT NOT NULL , 
PRIMARY KEY (`admin_id`)) ENGINE = InnoDB;

ALTER TABLE users
  ADD `reset_token_hash` VARCHAR(64) NULL DEFAULT NULL,
  ADD `reset_token_expires_at` DATETIME NULL DEFAULT NULL,
  ADD UNIQUE (`reset_token_hash`);

-- 
-- Test products
-- 
INSERT INTO `products`(`product_name`,`product_category`,`product_description`,
 `product_image`,`product_image2`, `product_image3`, `product_image4`,`product_price`,
 `product_special_offer`, `product_color`)VALUES ('white shoes', 'shoes','awesome white shoes',
  'vest1.jpg','vest1.jpg','vest1.jpg','vest1.jpg', 155,0,'white');



INSERT INTO `products`(`product_name`,`product_category`,`product_description`, 
  `product_image`,`product_image2`, `product_image3`, `product_image4`,`product_price`,
  `product_special_offer`, `product_color`)VALUES ('Note Book', 'note','Note book 64 page',
   'featured1.jpg','featured1.jpg','featured1.jpg','featured1.jpg', 10,0,'white');

INSERT INTO `products`(`product_name`,`product_category`,`product_description`, 
  `product_image`,`product_image2`, `product_image3`, `product_image4`,`product_price`,
  `product_special_offer`, `product_color`)VALUES ('Pen', 'Stationery','Black Pen',
   'penblack.jpg','penblack1.jpg','penblack.jpg','penblack.jpg', 3,0,'Black');

-- Admin login
INSERT INTO `admins` (`admin_id`, `admin_name`, `admin_email`, `admin_password`) VALUES (NULL, 'admin', 'admin@email.com', MD5('12345'));


--stock level 
ALTER TABLE products
  ADD COLUMN product_stock INT NOT NULL DEFAULT 0
  AFTER product_special_offer;

-- give your sample products some stock
UPDATE products SET product_stock = 12 WHERE product_name='white shoes';
UPDATE products SET product_stock = 40 WHERE product_name='Note Book';
UPDATE products SET product_stock = 5  WHERE product_name='Pen';
